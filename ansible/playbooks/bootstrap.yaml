---
- name: Setup Tailscale on nodes
  hosts: k3s_cluster
  become: true
  roles:
    - role: artis3n.tailscale.machine
      vars:
        tailscale_authkey: "{{ lookup('env', 'TAILSCALE_KEY') }}"
        tailscale_args: "--ssh"

- name: Install K3S cluster
  ansible.builtin.import_playbook: k3s-ansible/playbooks/site.yml

- name: Bootstrap apps on the cluster
  hosts: localhost
  connection: local
  gather_facts: false
  roles:
    - role: bootstrap
  vars:
    kubeconfig: "{{ kubeconfig }}"
    kubernetes_dir: "{{ playbook_dir }}/../../kubernetes"